sh_test(
    name = "ct",
    srcs = ["@com_google_cel_spec//tests:conftest.sh"],
    args = [
        "$(location @com_google_cel_spec//tests/simple:simple_test)",
        "--server=$(location //server/main:cel_server)",
        "--skip_test=comparisons/eq_literal/not_eq_list_false_vs_types,not_eq_map_false_vs_types",
        "--skip_test=comparisons/in_map_literal/key_in_mixed_key_type_map_error",
        "--skip_test=dynamic/int32/field_assign_proto2_range,field_assign_proto3_range",
        "--skip_test=dynamic/uint32/field_assign_proto2_range,field_assign_proto3_range",
        "--skip_test=dynamic/float/field_assign_proto2_range,field_assign_proto3_range",
        "--skip_test=dynamic/value_null/literal_unset,field_read_proto2_unset,field_read_proto3_unset",
        "--skip_test=enums/legacy_proto2/assign_standalone_int_too_big,assign_standalone_int_too_neg",
        "--skip_test=enums/legacy_proto3/assign_standalone_int_too_big,assign_standalone_int_too_neg",
        "--skip_test=enums/strong_proto2",
        "--skip_test=enums/strong_proto3",
        "--skip_test=fields/qualified_identifier_resolution/map_key_float,map_key_null,map_value_repeat_key",
        "--skip_test=integer_math/int64_math/int64_overflow_positive,int64_overflow_negative,uint64_overflow_positive,uint64_overflow_negative,int64_min_negate",
        "--skip_test=timestamps/timestamp_range/from_string_under,add_duration_under,add_duration_over",
        "$(location @com_google_cel_spec//tests/simple:testdata/plumbing.textproto)",
        "$(location @com_google_cel_spec//tests/simple:testdata/basic.textproto)",
        "$(location @com_google_cel_spec//tests/simple:testdata/comparisons.textproto)",
        "$(location @com_google_cel_spec//tests/simple:testdata/conversions.textproto)",
        "$(location @com_google_cel_spec//tests/simple:testdata/dynamic.textproto)",
        "$(location @com_google_cel_spec//tests/simple:testdata/enums.textproto)",
        "$(location @com_google_cel_spec//tests/simple:testdata/fields.textproto)",
        "$(location @com_google_cel_spec//tests/simple:testdata/fp_math.textproto)",
        "$(location @com_google_cel_spec//tests/simple:testdata/integer_math.textproto)",
        "$(location @com_google_cel_spec//tests/simple:testdata/lists.textproto)",
        "$(location @com_google_cel_spec//tests/simple:testdata/logic.textproto)",
        "$(location @com_google_cel_spec//tests/simple:testdata/macros.textproto)",
        "$(location @com_google_cel_spec//tests/simple:testdata/namespace.textproto)",
        "$(location @com_google_cel_spec//tests/simple:testdata/parse.textproto)",
        "$(location @com_google_cel_spec//tests/simple:testdata/proto2.textproto)",
        "$(location @com_google_cel_spec//tests/simple:testdata/proto3.textproto)",
        "$(location @com_google_cel_spec//tests/simple:testdata/string.textproto)",
        "$(location @com_google_cel_spec//tests/simple:testdata/timestamps.textproto)",
        "$(location @com_google_cel_spec//tests/simple:testdata/unknowns.textproto)",
    ],
    data = [
        "@com_google_cel_spec//tests/simple:simple_test",
        "//server/main:cel_server",
        "@com_google_cel_spec//tests/simple:testdata/plumbing.textproto",
        "@com_google_cel_spec//tests/simple:testdata/basic.textproto",
        "@com_google_cel_spec//tests/simple:testdata/comparisons.textproto",
        "@com_google_cel_spec//tests/simple:testdata/conversions.textproto",
        "@com_google_cel_spec//tests/simple:testdata/dynamic.textproto",
        "@com_google_cel_spec//tests/simple:testdata/enums.textproto",
        "@com_google_cel_spec//tests/simple:testdata/fields.textproto",
        "@com_google_cel_spec//tests/simple:testdata/fp_math.textproto",
        "@com_google_cel_spec//tests/simple:testdata/integer_math.textproto",
        "@com_google_cel_spec//tests/simple:testdata/lists.textproto",
        "@com_google_cel_spec//tests/simple:testdata/logic.textproto",
        "@com_google_cel_spec//tests/simple:testdata/parse.textproto",
        "@com_google_cel_spec//tests/simple:testdata/macros.textproto",
        "@com_google_cel_spec//tests/simple:testdata/namespace.textproto",
        "@com_google_cel_spec//tests/simple:testdata/proto2.textproto",
        "@com_google_cel_spec//tests/simple:testdata/proto3.textproto",
        "@com_google_cel_spec//tests/simple:testdata/string.textproto",
        "@com_google_cel_spec//tests/simple:testdata/timestamps.textproto",
        "@com_google_cel_spec//tests/simple:testdata/unknowns.textproto",
    ],
)

# ct_dashboard is a target for the conformance dashboard and includes all simple textproto files, including those that are broken.
sh_test(
    name = "ct_dashboard",
    srcs = ["@com_google_cel_spec//tests:conftest-nofail.sh"],
    args = [
        "$(location @com_google_cel_spec//tests/simple:simple_test)",
        "--server=$(location //server/main:cel_server)",
        "-test.v",
        # Failing due to a GCB builder issue
        "--skip_test=timestamps/timestamp_selectors_tz/getDate,getDayOfMonth_name_neg,getDayOfMonth_name_pos,getDayOfYear,getMinutes",
        "$(location @com_google_cel_spec//tests/simple:testdata/plumbing.textproto)",
        "$(location @com_google_cel_spec//tests/simple:testdata/basic.textproto)",
        "$(location @com_google_cel_spec//tests/simple:testdata/comparisons.textproto)",
        "$(location @com_google_cel_spec//tests/simple:testdata/conversions.textproto)",
        "$(location @com_google_cel_spec//tests/simple:testdata/dynamic.textproto)",
        "$(location @com_google_cel_spec//tests/simple:testdata/enums.textproto)",
        "$(location @com_google_cel_spec//tests/simple:testdata/fields.textproto)",
        "$(location @com_google_cel_spec//tests/simple:testdata/fp_math.textproto)",
        "$(location @com_google_cel_spec//tests/simple:testdata/integer_math.textproto)",
        "$(location @com_google_cel_spec//tests/simple:testdata/lists.textproto)",
        "$(location @com_google_cel_spec//tests/simple:testdata/logic.textproto)",
        "$(location @com_google_cel_spec//tests/simple:testdata/parse.textproto)",
        "$(location @com_google_cel_spec//tests/simple:testdata/macros.textproto)",
        "$(location @com_google_cel_spec//tests/simple:testdata/namespace.textproto)",
        "$(location @com_google_cel_spec//tests/simple:testdata/proto2.textproto)",
        "$(location @com_google_cel_spec//tests/simple:testdata/proto3.textproto)",
        "$(location @com_google_cel_spec//tests/simple:testdata/string.textproto)",
        "$(location @com_google_cel_spec//tests/simple:testdata/timestamps.textproto)",
        "$(location @com_google_cel_spec//tests/simple:testdata/unknowns.textproto)",
    ],
    data = [
        "@com_google_cel_spec//tests/simple:simple_test",
        "//server/main:cel_server",
        "@com_google_cel_spec//tests/simple:testdata/plumbing.textproto",
        "@com_google_cel_spec//tests/simple:testdata/basic.textproto",
        "@com_google_cel_spec//tests/simple:testdata/comparisons.textproto",
        "@com_google_cel_spec//tests/simple:testdata/conversions.textproto",
        "@com_google_cel_spec//tests/simple:testdata/dynamic.textproto",
        "@com_google_cel_spec//tests/simple:testdata/enums.textproto",
        "@com_google_cel_spec//tests/simple:testdata/fields.textproto",
        "@com_google_cel_spec//tests/simple:testdata/fp_math.textproto",
        "@com_google_cel_spec//tests/simple:testdata/integer_math.textproto",
        "@com_google_cel_spec//tests/simple:testdata/lists.textproto",
        "@com_google_cel_spec//tests/simple:testdata/logic.textproto",
        "@com_google_cel_spec//tests/simple:testdata/parse.textproto",
        "@com_google_cel_spec//tests/simple:testdata/macros.textproto",
        "@com_google_cel_spec//tests/simple:testdata/namespace.textproto",
        "@com_google_cel_spec//tests/simple:testdata/proto2.textproto",
        "@com_google_cel_spec//tests/simple:testdata/proto3.textproto",
        "@com_google_cel_spec//tests/simple:testdata/string.textproto",
        "@com_google_cel_spec//tests/simple:testdata/timestamps.textproto",
        "@com_google_cel_spec//tests/simple:testdata/unknowns.textproto",
    ],
)
